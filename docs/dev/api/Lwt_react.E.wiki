=Module <<a_api_type | module Lwt_react.E >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|E>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Lwt_react.E >><<span class="ocsforge_color_keyword"|end>>>>
----
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|include>> React.E>>


==@@id="2_Lwtspecificutilities"@@~Lwt~-specific utilities==

<<pre id="VALwith_finaliser" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|with~_finaliser>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|with~_finaliser f e>> returns an event <<span class="odocwiki_inlinecode"|e~'>> which behave as
        <<span class="odocwiki_inlinecode"|e>>~, except that <<span class="odocwiki_inlinecode"|f>> is called when <<span class="odocwiki_inlinecode"|e~'>> is garbage
        collected~.
>>
<<pre id="VALnext" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|next>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|next e>> returns the next occurrence of <<span class="odocwiki_inlinecode"|e>>~.


      ~Avoid trying to create an "asynchronous loop" by calling <<span class="odocwiki_inlinecode"|next e>> again in
      a callback attached to the promise returned by <<span class="odocwiki_inlinecode"|next e>>~:


* ~The callback is called within the ~React update step~, so calling <<span class="odocwiki_inlinecode"|next e>>
        within it will return a promise that is fulfilled with the same value as
        the current occurrence~.
* ~If you instead arrange for the ~React update step to end ~(for example~, by
        calling <<span class="odocwiki_inlinecode"|~Lwt~.pause ~(~)>> within the callback~)~, multiple ~React update steps
        may occur before the callback calls <<span class="odocwiki_inlinecode"|next e>> again~, so some occurrences
        can be effectively "lost~."

      ~To robustly asynchronously process occurrences of <<span class="odocwiki_inlinecode"|e>> in a loop~, use
      <<span class="odocwiki_inlinecode"|to~_stream e>>~, and repeatedly call <<a_api | val Lwt_stream.next >> on the resulting
      stream~.
>>
<<pre id="VALlimit" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|limit>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|limit f e>> limits the rate of <<span class="odocwiki_inlinecode"|e>> with <<span class="odocwiki_inlinecode"|f>>~.


        ~For example~, to limit the rate of an event to ~1 per second you
        can use~: <<span class="odocwiki_inlinecode"|limit ~(fun ~(~) ~-~> ~Lwt~_unix~.sleep ~1~.~0~) event>>~.
>>
<<pre id="VALfrom" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|from>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|from f>> creates an event which occurs each time <<span class="odocwiki_inlinecode"|f ~(~)>>
        returns a value~. ~If <<span class="odocwiki_inlinecode"|f>> raises an exception~, the event is just
        stopped~.
>>
<<pre id="VALto_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|to~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_stream.t" | type Lwt_stream.t >>>>>><<div class="odocwiki_info"|~Creates a stream holding all values occurring on the given
        event
>>
<<pre id="VALof_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|of~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="Lwt_stream.t" | type Lwt_stream.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|of~_stream stream>> creates an event which occurs each time a
        value is available on the stream~.
>>
<<pre id="VALdelay" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|delay>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|delay promise>> is an event which does not occur until
        <<span class="odocwiki_inlinecode"|promise>> resolves~. ~Then it behaves as the event returned by
        <<span class="odocwiki_inlinecode"|promise>>~.
>>
<<pre id="VALkeep" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|keep>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|keep e>> keeps a reference to <<span class="odocwiki_inlinecode"|e>> so it will never be garbage
        collected~.
>>


==@@id="2_ThreadedversionsofReacttransformationfunctions"@@~Threaded versions of ~React transformation functions==


~The following functions behave as their <<span class="odocwiki_inlinecode"|~React>> counterpart~,
      except that they take functions that may yield~.


      ~As usual the <<span class="odocwiki_inlinecode"|~_s>> suffix is used when calls are serialized~, and
      the <<span class="odocwiki_inlinecode"|~_p>> suffix is used when they are not~.


      ~Note that <<span class="odocwiki_inlinecode"|~*~_p>> functions may not preserve event order~.
<<pre id="VALapp_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|app~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALapp_p" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|app~_p>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALmap_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|map~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALmap_p" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|map~_p>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALfilter_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|filter~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALfilter_p" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|filter~_p>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALfmap_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fmap~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALfmap_p" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fmap~_p>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALdiff_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|diff~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALaccum_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|accum~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALfold_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fold~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALmerge_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|merge~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<span class="ocsforge_color_delimiter"| -> >> 'b <<a_api text="Lwt_react.event" | type Lwt_react.event >> list <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALrun_s" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|run~_s>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>><<pre id="VALrun_p" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|run~_p>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<a_api text="Lwt_react.event" | type Lwt_react.event >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api text="Lwt_react.event" | type Lwt_react.event >>>>>>